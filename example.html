<div class="inline-drawer">
    <div class="inline-drawer-toggle inline-drawer-header">
        <b>VN Background Gen</b>
        <div class="inline-drawer-icon fa-solid fa-circle-chevron-down down"></div>
    </div>
    <div class="inline-drawer-content">
        <div class="kazuma-settings">

            <!-- Enable Toggle -->
            <div class="kazuma-group">
                <label class="kazuma-row">
                    <span><i class="fa-solid fa-power-off"></i> Enable</span>
                    <input type="checkbox" id="kazuma_enable" />
                </label>
                <label class="kazuma-row">
                    <span><i class="fa-solid fa-rotate"></i> Auto-generate on message</span>
                    <input type="checkbox" id="kazuma_auto_gen" />
                </label>
            </div>

            <!-- Context Messages Slider -->
            <div class="kazuma-group">
                <div class="kazuma-slider-row">
                    <span><i class="fa-solid fa-clock-rotate-left"></i> Context Messages: <span id="kazuma_context_count_display">5</span></span>
                    <input type="range" id="kazuma_context_count" min="0" max="20" step="1" value="5">
                </div>
                <div class="kazuma-hint" style="font-size:0.85em; opacity:0.7; margin-top:2px;">
                    Number of previous messages to include as context (0 = main message only)
                </div>
            </div>

            <!-- Scene Extraction API -->
            <div class="kazuma-group">
                <div class="kazuma-header"><i class="fa-solid fa-robot"></i> Scene Extraction API</div>
                <div class="kazuma-sub-label">Endpoint</div>
                <input id="kazuma_tag_endpoint" type="text" class="text_pole" style="width:100%; margin-bottom:8px;"
                       placeholder="https://api.openai.com/v1/chat/completions">
                <div class="kazuma-sub-label">API Key</div>
                <input id="kazuma_tag_api_key" type="password" class="text_pole" style="width:100%; margin-bottom:8px;"
                       placeholder="sk-...">
                <div class="kazuma-sub-label">Model</div>
                <input id="kazuma_tag_model" type="text" class="text_pole" style="width:100%;"
                       placeholder="gpt-4o-mini">
            </div>

            <!-- ComfyUI Connection (URL only - no workflow selection) -->
            <div class="kazuma-group">
                <div class="kazuma-header"><i class="fa-solid fa-link"></i> ComfyUI</div>
                <div style="display:flex; gap: 5px;">
                    <input type="text" id="kazuma_url" class="text_pole" value="http://127.0.0.1:8188" style="flex:1;" />
                    <button id="kazuma_test_btn" class="menu_button" title="Test Connection"><i class="fa-solid fa-wifi"></i></button>
                </div>
            </div>

            <!-- Model Selection -->
            <div class="kazuma-group">
                <div class="kazuma-header"><i class="fa-solid fa-cube"></i> Checkpoint</div>
                <select id="kazuma_model_list" class="text_pole" style="width:100%"></select>
            </div>

            <!-- LoRA Selection (4 slots in collapsible) -->
            <details class="kazuma-details">
                <summary><i class="fa-solid fa-flask"></i> LoRAs (optional)</summary>
                <div class="kazuma-content">
                    <div class="kazuma-lora-box">
                        <div class="kazuma-sub-label">LoRA 1</div>
                        <select id="kazuma_lora_list" class="text_pole" style="width:100%"></select>
                        <div class="kazuma-slider-row" style="margin-top:5px;">
                            <span>Wt: <span id="kazuma_lora_wt_display">1.0</span></span>
                            <input type="range" id="kazuma_lora_wt" min="-2" max="2" step="0.1" value="1.0">
                        </div>
                    </div>
                    <div class="kazuma-lora-box">
                        <div class="kazuma-sub-label">LoRA 2</div>
                        <select id="kazuma_lora_list_2" class="text_pole" style="width:100%"></select>
                        <div class="kazuma-slider-row" style="margin-top:5px;">
                            <span>Wt: <span id="kazuma_lora_wt_display_2">1.0</span></span>
                            <input type="range" id="kazuma_lora_wt_2" min="-2" max="2" step="0.1" value="1.0">
                        </div>
                    </div>
                    <div class="kazuma-lora-box">
                        <div class="kazuma-sub-label">LoRA 3</div>
                        <select id="kazuma_lora_list_3" class="text_pole" style="width:100%"></select>
                        <div class="kazuma-slider-row" style="margin-top:5px;">
                            <span>Wt: <span id="kazuma_lora_wt_display_3">1.0</span></span>
                            <input type="range" id="kazuma_lora_wt_3" min="-2" max="2" step="0.1" value="1.0">
                        </div>
                    </div>
                    <div class="kazuma-lora-box">
                        <div class="kazuma-sub-label">LoRA 4</div>
                        <select id="kazuma_lora_list_4" class="text_pole" style="width:100%"></select>
                        <div class="kazuma-slider-row" style="margin-top:5px;">
                            <span>Wt: <span id="kazuma_lora_wt_display_4">1.0</span></span>
                            <input type="range" id="kazuma_lora_wt_4" min="-2" max="2" step="0.1" value="1.0">
                        </div>
                    </div>
                </div>
            </details>

        </div>
    </div>
</div>
